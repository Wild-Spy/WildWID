<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WIDLoggerV2Test: WIDLogV2.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">WIDLoggerV2Test
   &#160;<span id="projectnumber">V2.1</span>
   </div>
   <div id="projectbrief">Wireless ID Datalogger with GSM</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">WIDLogV2.c File Reference</div>  </div>
</div>
<div class="contents">

<p>WID Logger main source code file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="_w_i_d_log_v2_8h_source.html">WIDLogV2.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afabc41ff96b7954d5f4855e99b2eb408"></a><!-- doxytag: member="WIDLogV2.c::ISR" ref="afabc41ff96b7954d5f4855e99b2eb408" args="(RTC_OVF_vect)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>ISR</b> (RTC_OVF_vect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a521b31ff4bc4494a914b2a8cabcba31e"></a><!-- doxytag: member="WIDLogV2.c::ISR" ref="a521b31ff4bc4494a914b2a8cabcba31e" args="(PORTE_INT0_vect)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>ISR</b> (PORTE_INT0_vect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abc6e1844313aab2be0f995648c11fd95"></a><!-- doxytag: member="WIDLogV2.c::ISR" ref="abc6e1844313aab2be0f995648c11fd95" args="(PORTB_INT0_vect)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>ISR</b> (PORTB_INT0_vect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0734971b2c3847c6e527957b3c331ebb"></a><!-- doxytag: member="WIDLogV2.c::ISR" ref="a0734971b2c3847c6e527957b3c331ebb" args="(PORTC_INT0_vect)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>ISR</b> (PORTC_INT0_vect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a06e269e09511fe0354626506e43e8e05"></a><!-- doxytag: member="WIDLogV2.c::ISR" ref="a06e269e09511fe0354626506e43e8e05" args="(PORTD_INT0_vect)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>ISR</b> (PORTD_INT0_vect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a04b2181bef53144f030b82c4d88a7bc8"></a><!-- doxytag: member="WIDLogV2.c::ISR" ref="a04b2181bef53144f030b82c4d88a7bc8" args="(TCC0_OVF_vect)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>ISR</b> (TCC0_OVF_vect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Brief Description.  <a href="#ae66f6b31b5ad750f1fe042a706a4e3d4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#abb5a879e8b490d791736dfc0416f5d87">MainLoop_Active_Mode</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Brief Description.  <a href="#abb5a879e8b490d791736dfc0416f5d87"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ac15c54dbe8c7d617add8eb980bf52861">MainLoop_BatBackup_NoBat_Mode</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Brief Description.  <a href="#ac15c54dbe8c7d617add8eb980bf52861"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abab464780fb9b559eae2f471b0430b39"></a><!-- doxytag: member="WIDLogV2.c::MainLoop_BatBackup_LoBat_Mode" ref="abab464780fb9b559eae2f471b0430b39" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>MainLoop_BatBackup_LoBat_Mode</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0fe952ac0900f7920c0e2f7d9becc09f"></a><!-- doxytag: member="WIDLogV2.c::SetupHardware" ref="a0fe952ac0900f7920c0e2f7d9becc09f" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>SetupHardware</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5b47e15c797c70f5fd515f9021714d4"></a><!-- doxytag: member="WIDLogV2.c::EnterBatBakMode" ref="ae5b47e15c797c70f5fd515f9021714d4" args="(uint8_t Reason)" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>EnterBatBakMode</b> (uint8_t Reason)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a727ec26c8faa3e5aba0fb563a169a08a"></a><!-- doxytag: member="WIDLogV2.c::WakeFromBatBakMode" ref="a727ec26c8faa3e5aba0fb563a169a08a" args="()" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>WakeFromBatBakMode</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#acd5ddfaaefda0dc38aedc99330d23fd5">CheckBatteryVoltage</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the main battery voltage in volts.  <a href="#acd5ddfaaefda0dc38aedc99330d23fd5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a21eaf3601c46e6d83d8024e0986f1b31"></a><!-- doxytag: member="WIDLogV2.c::CalibrateADCOffset" ref="a21eaf3601c46e6d83d8024e0986f1b31" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>CalibrateADCOffset</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ac57193527246c9bace885a5f7106addd">ADCRead</a> (uint8_t SAMP)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the voltage on ADC A, Channel 0.  <a href="#ac57193527246c9bace885a5f7106addd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a02bfd8a1f09f2fda4821f801617f05d0">RTCWakeChecks</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs many checks every time the RTC ticks.  <a href="#a02bfd8a1f09f2fda4821f801617f05d0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#acafc28a4f21cc5648cedc0d388388919">SendEmailChecks</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a brief description.  <a href="#acafc28a4f21cc5648cedc0d388388919"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a25934e3f82062ab3cba2ac1b5bfc7582">ReelInTheYears</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the next scheduled send email time.  <a href="#a25934e3f82062ab3cba2ac1b5bfc7582"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#aa8d6cb4ca4be7c99c55f1bca0992fb21">doRFWork</a> (uint8_t dispLvl)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Process received messages in the nordic RX buffer.  <a href="#aa8d6cb4ca4be7c99c55f1bca0992fb21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a66798f7c96859a4f82b2e90f0b107955">UpdateTagList</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ae16a1ceee2ca44113ca8cdb796cd2ad0">saveRecord</a> (<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a> *mTime, uint32_t *ID)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves a tag pickup.  <a href="#ae16a1ceee2ca44113ca8cdb796cd2ad0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a95a9a6377233b2373495bf007c26e4bb">loadRecord</a> (uint32_t RecordNo, <a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a> *mTime, uint32_t *ID)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a record from the serial flash.  <a href="#a95a9a6377233b2373495bf007c26e4bb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a2675e675d7130b010321c509f1c00ab8">RecordToFlash</a> (<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a> *mTime, uint32_t ID, uint8_t Flags)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves the passed information to flash.  <a href="#a2675e675d7130b010321c509f1c00ab8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#abf9589e122e931adada7a63485dff26e">StartTim10ms</a> (uint16_t Time)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the 10 millisecond timer on TC0.  <a href="#abf9589e122e931adada7a63485dff26e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ac38ccdb98fe283afb054a258a20be166">StopTim10ms</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the 10 millisecond timer on TC0.  <a href="#ac38ccdb98fe283afb054a258a20be166"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a34b67ece5b34ee4b59c534ea2662d324">save_PC</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Save the program counter.  <a href="#a34b67ece5b34ee4b59c534ea2662d324"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#adbfc6d98362d5041937b76a063a81e16">ReadCalibrationByte</a> (uint8_t index)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a calibration byte from the MCU at address of index.  <a href="#adbfc6d98362d5041937b76a063a81e16"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#acfb9c15230fc48caa542a8d61d0e9ec5">FilterStr2Mask</a> (char *filtStr)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the active filter to the filter String passed.  <a href="#acfb9c15230fc48caa542a8d61d0e9ec5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ad1eff8fb6f4da201ec5503c59a48e406">FindRecordCount</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Count the number of stored records in the flash memory.  <a href="#ad1eff8fb6f4da201ec5503c59a48e406"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a39816bdd6119d57ed28c8e62610321fa">SetClkSpeed</a> (uint8_t speed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the system's clock speed.  <a href="#a39816bdd6119d57ed28c8e62610321fa"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a549792845204ff38cf651201346fdcea"></a><!-- doxytag: member="WIDLogV2.c::deadByte" ref="a549792845204ff38cf651201346fdcea" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>deadByte</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa4552517be507d79e286a47269c216fa"></a><!-- doxytag: member="WIDLogV2.c::s" ref="aa4552517be507d79e286a47269c216fa" args="[80]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><b>s</b> [80]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acbc79aa55b37f973eb9cf0922b499e4b"></a><!-- doxytag: member="WIDLogV2.c::myRF_ID" ref="acbc79aa55b37f973eb9cf0922b499e4b" args="[5]" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#acbc79aa55b37f973eb9cf0922b499e4b">myRF_ID</a> [5]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">ID on the nordic chip default = {0xE6,0xE6,0xE6,0xE6,0xE6};. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a70c87b2cdd8909b86f9017a31c532ddd"></a><!-- doxytag: member="WIDLogV2.c::myRF_Chan" ref="a70c87b2cdd8909b86f9017a31c532ddd" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a70c87b2cdd8909b86f9017a31c532ddd">myRF_Chan</a> = 2</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Channel on the nordic chip. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab31e4ba7d4f3a5eef5e64d52752a19c5"></a><!-- doxytag: member="WIDLogV2.c::LoggerName" ref="ab31e4ba7d4f3a5eef5e64d52752a19c5" args="[20]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ab31e4ba7d4f3a5eef5e64d52752a19c5">LoggerName</a> [20] = &quot;TestLogger&quot;</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to ID the logger 19 characters long (20 with the the '\0') <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4ec72da27525c8be368bfa8163de7300"></a><!-- doxytag: member="WIDLogV2.c::timer10ms" ref="a4ec72da27525c8be368bfa8163de7300" args="" -->
volatile uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a4ec72da27525c8be368bfa8163de7300">timer10ms</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to keep track of how many 10ms blocks have passed since the 10ms timer was started. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4881e8aa941363e3e8989948a1128f29"></a><!-- doxytag: member="WIDLogV2.c::Wakeup_Source" ref="a4881e8aa941363e3e8989948a1128f29" args="" -->
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a4881e8aa941363e3e8989948a1128f29">Wakeup_Source</a> = WAKEUP_SOURCE_NONE</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Holds information on what source woke up the device from sleep mode. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a61deaf63a68871f70b1e1e9ba346778c"></a><!-- doxytag: member="WIDLogV2.c::RecordCount" ref="a61deaf63a68871f70b1e1e9ba346778c" args="" -->
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a61deaf63a68871f70b1e1e9ba346778c">RecordCount</a> = 0L</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">No. of records in dataflash. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad081cfd73e310d7f32dc4f9729315430"></a><!-- doxytag: member="WIDLogV2.c::gotRecCnt" ref="ad081cfd73e310d7f32dc4f9729315430" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ad081cfd73e310d7f32dc4f9729315430">gotRecCnt</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Have we found the record count yet? <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae940c8ba28616cdace894eac5fb12886"></a><!-- doxytag: member="WIDLogV2.c::TagUpdate" ref="ae940c8ba28616cdace894eac5fb12886" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ae940c8ba28616cdace894eac5fb12886">TagUpdate</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Counter.. when it gets to 0, the tagupdate function is executed. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a330be6f2845c34977a3b063374149f27"></a><!-- doxytag: member="WIDLogV2.c::Startup" ref="a330be6f2845c34977a3b063374149f27" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a330be6f2845c34977a3b063374149f27">Startup</a> = 1</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">About to startup? <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0576afccca8f21cd3a4f00fb940948dc"></a><!-- doxytag: member="WIDLogV2.c::CheckBatVolt" ref="a0576afccca8f21cd3a4f00fb940948dc" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a0576afccca8f21cd3a4f00fb940948dc">CheckBatVolt</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Counter for checking battery voltage (checks every 5? seconds) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab67bb79d4b8d1d5d7bae6ad98aa864b1"></a><!-- doxytag: member="WIDLogV2.c::tmpBatV" ref="ab67bb79d4b8d1d5d7bae6ad98aa864b1" args="" -->
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ab67bb79d4b8d1d5d7bae6ad98aa864b1">tmpBatV</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The last read battery voltage. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9042a1292e10f9257456073a13fd0627"></a><!-- doxytag: member="WIDLogV2.c::RTC_c_Time" ref="a9042a1292e10f9257456073a13fd0627" args="" -->
<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a9042a1292e10f9257456073a13fd0627">RTC_c_Time</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">RTC time -&gt; real time stored here. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a675a47b57407c56dbf9496bae2487fc9"></a><!-- doxytag: member="WIDLogV2.c::RTC_Period" ref="a675a47b57407c56dbf9496bae2487fc9" args="" -->
<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a675a47b57407c56dbf9496bae2487fc9">RTC_Period</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Time that elapses per RTC period (1 second) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a99b43f774db02d5f6981bdcfffa743b8"></a><!-- doxytag: member="WIDLogV2.c::Send_Data_GPRS_Next" ref="a99b43f774db02d5f6981bdcfffa743b8" args="" -->
<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a99b43f774db02d5f6981bdcfffa743b8">Send_Data_GPRS_Next</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Next time to attempt to send an email. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a270a076baffe8a5acb7829d0ef71ed94"></a><!-- doxytag: member="WIDLogV2.c::Send_Data_GPRS_Next_Real" ref="a270a076baffe8a5acb7829d0ef71ed94" args="" -->
<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a270a076baffe8a5acb7829d0ef71ed94">Send_Data_GPRS_Next_Real</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Next scheduled time to send an email. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5955b714f4c19a99cfd451a00c36e68a"></a><!-- doxytag: member="WIDLogV2.c::Send_Data_GPRS_Period" ref="a5955b714f4c19a99cfd451a00c36e68a" args="" -->
<a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a5955b714f4c19a99cfd451a00c36e68a">Send_Data_GPRS_Period</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">An email is scheduled to be sent once every period. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a15d4b004784b3deafa78bae1963cb23c"></a><!-- doxytag: member="WIDLogV2.c::Send_Data_GPRS_Retries_Remaining" ref="a15d4b004784b3deafa78bae1963cb23c" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a15d4b004784b3deafa78bae1963cb23c">Send_Data_GPRS_Retries_Remaining</a> = SEND_DATA_GPRS_RETRIES_MAX</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of retries remaining before aborting this email and waiting for next scheduled send email time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a51fa168d5c614ebdbc65a2b604a50f0d"></a><!-- doxytag: member="WIDLogV2.c::TagDispMode" ref="a51fa168d5c614ebdbc65a2b604a50f0d" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a51fa168d5c614ebdbc65a2b604a50f0d">TagDispMode</a> = 1</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">How tags are displayed (None (1), show ID only(2), ID and date/time or ID(3), Date/Time and Address(4)) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4a83136364711989bb7ac26e8d4ecd9a"></a><!-- doxytag: member="WIDLogV2.c::bBak_Mode" ref="a4a83136364711989bb7ac26e8d4ecd9a" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a4a83136364711989bb7ac26e8d4ecd9a">bBak_Mode</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Are we in battery backup mode? <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac4d925e6d7bf52a35ad73d3f4625836b"></a><!-- doxytag: member="WIDLogV2.c::bBak_Reason" ref="ac4d925e6d7bf52a35ad73d3f4625836b" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ac4d925e6d7bf52a35ad73d3f4625836b">bBak_Reason</a> = BBAK_REASON_NONE</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Why are we in battery backup mode? <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a367bc0e644318182e3df07c350d20703"></a><!-- doxytag: member="WIDLogV2.c::PC_saved" ref="a367bc0e644318182e3df07c350d20703" args="[3]" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a367bc0e644318182e3df07c350d20703">PC_saved</a> [3]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Saved address of Program Counter (pointer to address just before program goes to sleep) used to unsafely abort all operations and put the device to sleep immediately! <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a94e29d5f4d088eaac8c059be966ec72c"></a><!-- doxytag: member="WIDLogV2.c::SP_saved" ref="a94e29d5f4d088eaac8c059be966ec72c" args="" -->
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a94e29d5f4d088eaac8c059be966ec72c">SP_saved</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Saved stack pointer address, used in conjunction with PC_saved variable above. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a124b44b4be675373482e85b4e3222fb6"></a><!-- doxytag: member="WIDLogV2.c::batBakTrig" ref="a124b44b4be675373482e85b4e3222fb6" args="" -->
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a124b44b4be675373482e85b4e3222fb6">batBakTrig</a> = 2</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Variable used in managing battery backup modes. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab86dac3ce09ec367266c3f624eb3bb39"></a><!-- doxytag: member="WIDLogV2.c::ADCOffset" ref="ab86dac3ce09ec367266c3f624eb3bb39" args="" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ab86dac3ce09ec367266c3f624eb3bb39">ADCOffset</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Offset of the ADC (see datasheet on ADC offset) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a01995125f763281586037c8ca72739ba"></a><!-- doxytag: member="WIDLogV2.c::LoggingEnabled" ref="a01995125f763281586037c8ca72739ba" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>LoggingEnabled</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a35969dbc8b1ea0daf67154f20967ae3d"></a><!-- doxytag: member="WIDLogV2.c::EnterGM862BridgeMode" ref="a35969dbc8b1ea0daf67154f20967ae3d" args="" -->
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a35969dbc8b1ea0daf67154f20967ae3d">EnterGM862BridgeMode</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set in the SerComms library, tells the logger to enter GM862 Bridge mode which can be exited by sending 0x03 from the computer. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4a6c8c811ee23e5b099be84ca5d3935d"></a><!-- doxytag: member="WIDLogV2.c::Filter" ref="a4a6c8c811ee23e5b099be84ca5d3935d" args="[8]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a4a6c8c811ee23e5b099be84ca5d3935d">Filter</a> [8] = {'*','*','*','*','*','*','*','*'}</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Filter String. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae8c55e6ba2fd990dff84d043d73828bc"></a><!-- doxytag: member="WIDLogV2.c::FilterCode" ref="ae8c55e6ba2fd990dff84d043d73828bc" args="" -->
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ae8c55e6ba2fd990dff84d043d73828bc">FilterCode</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Filter Code. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a280a5c35924d6a04ceb83e39fe8e8614"></a><!-- doxytag: member="WIDLogV2.c::FilterMask" ref="a280a5c35924d6a04ceb83e39fe8e8614" args="" -->
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a280a5c35924d6a04ceb83e39fe8e8614">FilterMask</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4265ec35fb6a2ee11d8d84ee813066b0"></a><!-- doxytag: member="WIDLogV2.c::MList_Data" ref="a4265ec35fb6a2ee11d8d84ee813066b0" args="[LISTMAXSIZE]" -->
<a class="el" href="struct___list_struct__t.html">ListStruct_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a4265ec35fb6a2ee11d8d84ee813066b0">MList_Data</a> [LISTMAXSIZE]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From <a class="el" href="_m___list_8c.html" title="List &#39;class&#39; implementation.">M_List.c</a>. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a09effb71eba19e741d352259744b3439"></a><!-- doxytag: member="WIDLogV2.c::MList_Count" ref="a09effb71eba19e741d352259744b3439" args="" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a09effb71eba19e741d352259744b3439">MList_Count</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From <a class="el" href="_m___list_8c.html" title="List &#39;class&#39; implementation.">M_List.c</a>. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6642e3c587e23d23f04c0dc721251dcd"></a><!-- doxytag: member="WIDLogV2.c::records_sent_already" ref="a6642e3c587e23d23f04c0dc721251dcd" args="" -->
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a6642e3c587e23d23f04c0dc721251dcd">records_sent_already</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From MX_GM862.c. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a58b93983dd419bc22470e3ca30adc24c"></a><!-- doxytag: member="WIDLogV2.c::EmailToAddress" ref="a58b93983dd419bc22470e3ca30adc24c" args="[60]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a58b93983dd419bc22470e3ca30adc24c">EmailToAddress</a> [60]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From MX_GM862.c. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a86974a5c89493c13ea341748d2596dc5"></a><!-- doxytag: member="WIDLogV2.c::GPRS_APN" ref="a86974a5c89493c13ea341748d2596dc5" args="[30]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#a86974a5c89493c13ea341748d2596dc5">GPRS_APN</a> [30]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From MX_GM862.c. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab485191958b630d88afb9ccafe07acd6"></a><!-- doxytag: member="WIDLogV2.c::GPRS_UserId" ref="ab485191958b630d88afb9ccafe07acd6" args="[30]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#ab485191958b630d88afb9ccafe07acd6">GPRS_UserId</a> [30]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From MX_GM862.c. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af819695577d33a6ce604361178120d45"></a><!-- doxytag: member="WIDLogV2.c::GPRS_Passw" ref="af819695577d33a6ce604361178120d45" args="[30]" -->
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_w_i_d_log_v2_8c.html#af819695577d33a6ce604361178120d45">GPRS_Passw</a> [30]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">From MX_GM862.c. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>WID Logger main source code file. </p>
<p>This file contains the main function as well as the majority of the device specific code for the WID Logger.</p>
<dl class="user"><dt><b>Documentation</b></dt><dd>No further documentation as of yet.</dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Matthew Cochrane <br/>
 Wild Spy</dd></dl>
<dl class="rcs"><dt><b>Revision:</b></dt><dd>0 </dd></dl>
<dl class="rcs"><dt><b>Date:</b></dt><dd>01/10/2011 </dd></dl>
<p><br/>
 </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="ac57193527246c9bace885a5f7106addd"></a><!-- doxytag: member="WIDLogV2.c::ADCRead" ref="ac57193527246c9bace885a5f7106addd" args="(uint8_t SAMP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ADCRead </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>SAMP</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read the voltage on ADC A, Channel 0. </p>
<p>Take 2^SAMP samples of the pin voltage and average them</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">SAMP</td><td>number of samples = 2^SAMP </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Voltage on ADC A, Channel 0. </dd></dl>

</div>
</div>
<a class="anchor" id="acd5ddfaaefda0dc38aedc99330d23fd5"></a><!-- doxytag: member="WIDLogV2.c::CheckBatteryVoltage" ref="acd5ddfaaefda0dc38aedc99330d23fd5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float CheckBatteryVoltage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the main battery voltage in volts. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Battery voltage, in volts, as a floating point number. </dd></dl>

</div>
</div>
<a class="anchor" id="aa8d6cb4ca4be7c99c55f1bca0992fb21"></a><!-- doxytag: member="WIDLogV2.c::doRFWork" ref="aa8d6cb4ca4be7c99c55f1bca0992fb21" args="(uint8_t dispLvl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doRFWork </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dispLvl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process received messages in the nordic RX buffer. </p>
<p>For each received message (tag), if the received ID passes the filter criteria, print out the desired level of information to the serial port (based on dispLvl) and save the record using the <a class="el" href="_w_i_d_log_v2_8c.html#ae16a1ceee2ca44113ca8cdb796cd2ad0" title="Saves a tag pickup.">saveRecord()</a> function.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dispLvl</td><td><ul>
<li>RF_DISP_TAGID: Print the tag ID only.</li>
<li>RF_DISP_TAGIDTIME: Print tag ID and pickup time.</li>
<li>RF_DISP_TAGIDTIMEADD: Print tag ID, pickup time and flash save address (this doesn't really make sense any more, with the taglist)</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="_w_i_d_log_v2_8c.html#ae16a1ceee2ca44113ca8cdb796cd2ad0" title="Saves a tag pickup.">saveRecord()</a>, <a class="el" href="_w_i_d_log_v2_8c.html#acfb9c15230fc48caa542a8d61d0e9ec5" title="Sets the active filter to the filter String passed.">FilterStr2Mask()</a> and <a class="el" href="_w_i_d_log_v2_8c.html#a51fa168d5c614ebdbc65a2b604a50f0d" title="How tags are displayed (None (1), show ID only(2), ID and date/time or ID(3), Date/Time and Address(4...">TagDispMode</a> </dd></dl>

</div>
</div>
<a class="anchor" id="acfb9c15230fc48caa542a8d61d0e9ec5"></a><!-- doxytag: member="WIDLogV2.c::FilterStr2Mask" ref="acfb9c15230fc48caa542a8d61d0e9ec5" args="(char *filtStr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FilterStr2Mask </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>filtStr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets the active filter to the filter String passed. </p>
<p>Takes an 8 character string as an input and produces a filter code and a filter mask which are used to choose which received tags are saved to flash. The active filter for the logger is set to this.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">filtStr</td><td>- Filter String input </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad1eff8fb6f4da201ec5503c59a48e406"></a><!-- doxytag: member="WIDLogV2.c::FindRecordCount" ref="ad1eff8fb6f4da201ec5503c59a48e406" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t FindRecordCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Count the number of stored records in the flash memory. </p>
<p>Search through the external flash memory and count how many records are stored there in total. It does this by counting until it finds an empty record.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Record count on serial flash </dd></dl>

</div>
</div>
<a class="anchor" id="a95a9a6377233b2373495bf007c26e4bb"></a><!-- doxytag: member="WIDLogV2.c::loadRecord" ref="a95a9a6377233b2373495bf007c26e4bb" args="(uint32_t RecordNo, RTC_Time_t *mTime, uint32_t *ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t loadRecord </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>RecordNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a> *&#160;</td>
          <td class="paramname"><em>mTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads a record from the serial flash. </p>
<p>The record at record number RecordNo is read from the serial flash and returned through the two pointers mTime and ID.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">RecordNo</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mTime</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ID</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0xFF if the function failed, the entries flag value otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a><!-- doxytag: member="WIDLogV2.c::main" ref="ae66f6b31b5ad750f1fe042a706a4e3d4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Brief Description. </p>
<p>A more elaborate description. (can be multiple lines). </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Desctiption as int </dd></dl>

</div>
</div>
<a class="anchor" id="abb5a879e8b490d791736dfc0416f5d87"></a><!-- doxytag: member="WIDLogV2.c::MainLoop_Active_Mode" ref="abb5a879e8b490d791736dfc0416f5d87" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MainLoop_Active_Mode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Brief Description. </p>
<p>A more elaborate description. (can be multiple lines). </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Desctiption as void </dd></dl>

</div>
</div>
<a class="anchor" id="ac15c54dbe8c7d617add8eb980bf52861"></a><!-- doxytag: member="WIDLogV2.c::MainLoop_BatBackup_NoBat_Mode" ref="ac15c54dbe8c7d617add8eb980bf52861" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MainLoop_BatBackup_NoBat_Mode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Brief Description. </p>
<p>A more elaborate description. (can be multiple lines). </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Desctiption as void </dd></dl>

</div>
</div>
<a class="anchor" id="adbfc6d98362d5041937b76a063a81e16"></a><!-- doxytag: member="WIDLogV2.c::ReadCalibrationByte" ref="adbfc6d98362d5041937b76a063a81e16" args="(uint8_t index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ReadCalibrationByte </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads a calibration byte from the MCU at address of index. </p>
<p>Returns a calibration byte, read from the MCU calibration bytes at the address of the parameter index</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>Index of the calibration byte to read </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The value of the read calibration byte </dd></dl>

</div>
</div>
<a class="anchor" id="a2675e675d7130b010321c509f1c00ab8"></a><!-- doxytag: member="WIDLogV2.c::RecordToFlash" ref="a2675e675d7130b010321c509f1c00ab8" args="(RTC_Time_t *mTime, uint32_t ID, uint8_t Flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t RecordToFlash </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a> *&#160;</td>
          <td class="paramname"><em>mTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>Flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Saves the passed information to flash. </p>
<p>The information is saved to the next free entry in the data flash which is calculated from the value of RecordCount.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">mTime</td><td>the time that the event occurred </td></tr>
    <tr><td class="paramname">ID</td><td>The ID of the tag </td></tr>
    <tr><td class="paramname">Flags</td><td>2-bit flag value, usually represents whether this is to be a start, stop or system message entry </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if success, 0 if failure </dd></dl>

</div>
</div>
<a class="anchor" id="a25934e3f82062ab3cba2ac1b5bfc7582"></a><!-- doxytag: member="WIDLogV2.c::ReelInTheYears" ref="a25934e3f82062ab3cba2ac1b5bfc7582" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReelInTheYears </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finds the next scheduled send email time. </p>
<p>Keeps adding <a class="el" href="_w_i_d_log_v2_8c.html#a5955b714f4c19a99cfd451a00c36e68a" title="An email is scheduled to be sent once every period.">Send_Data_GPRS_Period</a> to <a class="el" href="_w_i_d_log_v2_8c.html#a99b43f774db02d5f6981bdcfffa743b8" title="Next time to attempt to send an email.">Send_Data_GPRS_Next</a> until <a class="el" href="_w_i_d_log_v2_8c.html#a99b43f774db02d5f6981bdcfffa743b8" title="Next time to attempt to send an email.">Send_Data_GPRS_Next</a> is after the current RTC time (<a class="el" href="_w_i_d_log_v2_8c.html#a9042a1292e10f9257456073a13fd0627" title="RTC time -&gt; real time stored here.">RTC_c_Time</a>). This has nothing to do with the send email retry attempts. It is only modifying the next scheduled real send data time.</p>
<dl class="see"><dt><b>See also:</b></dt><dd>AddTimes() and FirstTimeGreaterOrEqualTo() </dd></dl>

</div>
</div>
<a class="anchor" id="a02bfd8a1f09f2fda4821f801617f05d0"></a><!-- doxytag: member="WIDLogV2.c::RTCWakeChecks" ref="a02bfd8a1f09f2fda4821f801617f05d0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RTCWakeChecks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Performs many checks every time the RTC ticks. </p>
<p>This function is called only if the device is in active mode (ie not in battery backup mode) once every RTC tick period (which is once a second). It does the following tasks:</p>
<ul>
<li>Check that the nordic chip is working properly and fix it if it's not.</li>
<li>Update the tag list once every #TAGLISTUPDATE seconds.</li>
<li>Handle all the SendEmail stuff****</li>
<li>Check the battery voltage once every #BATVOLTCHECK seconds and if it's too low, put the device into battery backup mode. </li>
</ul>

</div>
</div>
<a class="anchor" id="a34b67ece5b34ee4b59c534ea2662d324"></a><!-- doxytag: member="WIDLogV2.c::save_PC" ref="a34b67ece5b34ee4b59c534ea2662d324" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void save_PC </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Save the program counter. </p>
<p>The the return address of this function (ie. the address of the program counter after the function returns) is saved into the PC_saved array. </p>

</div>
</div>
<a class="anchor" id="ae16a1ceee2ca44113ca8cdb796cd2ad0"></a><!-- doxytag: member="WIDLogV2.c::saveRecord" ref="ae16a1ceee2ca44113ca8cdb796cd2ad0" args="(RTC_Time_t *mTime, uint32_t *ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t saveRecord </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_r_t_c_time.html">RTC_Time_t</a> *&#160;</td>
          <td class="paramname"><em>mTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Saves a tag pickup. </p>
<p>Doesn't necessarily save that event to flash. Only the first and last events are written to flash. If the tag is not already in the list <a class="el" href="_w_i_d_log_v2_8c.html#a4265ec35fb6a2ee11d8d84ee813066b0" title="From M_List.c.">MList_Data</a> then it will be saved to flash with a start condition and added to the list. If the tag is already in the list then update the time of the list entry to the new time but do not save it to the serial flash.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">mTime</td><td>The time of the tag pickup event </td></tr>
    <tr><td class="paramname">ID</td><td>The ID of the tag that was picked up </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 for success, 1 for full buffer, 2 for Flash write failure </dd></dl>

</div>
</div>
<a class="anchor" id="acafc28a4f21cc5648cedc0d388388919"></a><!-- doxytag: member="WIDLogV2.c::SendEmailChecks" ref="acafc28a4f21cc5648cedc0d388388919" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SendEmailChecks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is a brief description. </p>
<p>So the basic gist of how this function works: There are three important variables: (A) Send_Data_GPRS_Next - This is the next time this section of code will be entered (B) Send_Data_GPRS_Next_Real - This is the next 'scheduled' send-email time (C) Send_Data_GPRS_Retries_Remaining - This is the number of send-email attempts left before skipping this email and waiting for the next scheduled email time to try again</p>
<p>The code will try and send an email up to (SEND_DATA_GPRS_RETRIES_MAX) times with 15? minutes wait between attempts. If the email send succeeds or we run out of attempts then the next time is set to (B) which is the next scheduled time (one sendemailperiod after the last send_data_next_real). (A) is set to 15? minutes after the current RTC time every time the section is entered (unless it's the last attempt, then it's set to the next scheduled attempt). This happens before the sendEmail() subroutine is executed so that if the module goes into bat-backup mode during an email send, the next time is still in the future. More importantly, (3) is decremented before sendEmail() is executed so that the module doesn't get stuck in an endless loop with the system restarting? If the device enters bat-bak mode (battery removed) during an email send then, when the device wakes up again, if (A) is not at least 15? minutes after the current time, it is set to 15 minutes after the current time and (B) is set to the next scheduled time after the current time. This means that the device won't wake up and send an email straight away but will wait at least 15? minutes first (if the next wakeup time was before now or in the next 15 minutes). </p>

</div>
</div>
<a class="anchor" id="a39816bdd6119d57ed28c8e62610321fa"></a><!-- doxytag: member="WIDLogV2.c::SetClkSpeed" ref="a39816bdd6119d57ed28c8e62610321fa" args="(uint8_t speed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetClkSpeed </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>speed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets the system's clock speed. </p>
<p>Sets the system clock based on the parameter 'speed'.<br/>
 speed:</p>
<ul>
<li>CLK_SPD_32MHz: Enable and select 32MHz internal RC oscillator.</li>
<li>CLK_SPD_12MHz_SETUP: Enable and select 12MHz clock source from 2MHz internal RC oscillator and PLL</li>
<li>CLK_SPD_12MHz_SWITCH: Switch to already configured 12MHz clock source.</li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">speed</td><td>Speed to set the clock to. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="abf9589e122e931adada7a63485dff26e"></a><!-- doxytag: member="WIDLogV2.c::StartTim10ms" ref="abf9589e122e931adada7a63485dff26e" args="(uint16_t Time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StartTim10ms </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>Time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start the 10 millisecond timer on TC0. </p>
<p>The timer counts down from Time to 0 and then stops. Each tick is 10 milliseconds long.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">Time</td><td>The number to start counting down from </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac38ccdb98fe283afb054a258a20be166"></a><!-- doxytag: member="WIDLogV2.c::StopTim10ms" ref="ac38ccdb98fe283afb054a258a20be166" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StopTim10ms </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop the 10 millisecond timer on TC0. </p>
<p>Stops the 10 millisecond timer on TC0 from running and sets the timer10ms variable to 0. </p>

</div>
</div>
<a class="anchor" id="a66798f7c96859a4f82b2e90f0b107955"></a><!-- doxytag: member="WIDLogV2.c::UpdateTagList" ref="a66798f7c96859a4f82b2e90f0b107955" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateTagList </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If a tag in <a class="el" href="_w_i_d_log_v2_8c.html#a4265ec35fb6a2ee11d8d84ee813066b0" title="From M_List.c.">MList_Data</a> has not been picked up in the last #TAGLISTUPDATE seconds, save a stop record to the flash for that tag at the last time it was picked up and remove it from the list. Does this for each tag in <a class="el" href="_w_i_d_log_v2_8c.html#a4265ec35fb6a2ee11d8d84ee813066b0" title="From M_List.c.">MList_Data</a>. </p>

</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 3 2011 13:09:38 for WIDLoggerV2Test by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
